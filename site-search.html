<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Adam's search page</title>

  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: "Comic Sans MS", "Comic Sans", "Patrick Hand", cursive;
      background-image: url('archway.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;

      color: blue;
      font-size: 1.25em;
      text-align: left;
      padding: 20px;
    }

    h2 {
      font-size: 2.2em;
      text-transform: lowercase;
      background: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet);
      -webkit-background-clip: text;
      color: #e0bbe4;
      text-shadow: 2px 2px 5px #FF69B4;
      margin: 0 0 10px 0;
    }

    .panel {
      max-width: 1040px;
      background: rgba(255,255,255,0.75);
      border-radius: 14px;
      padding: 14px 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      backdrop-filter: blur(2px);
    }

    .row {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    input[type="text"] {
      padding: 10px 12px;
      min-width: 320px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.2);
      font-family: inherit;
      font-size: 1.05em;
    }

    button, select {
      padding: 8px 10px;
      cursor: pointer;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.2);
      background: rgba(255,255,255,0.85);
      font-family: inherit;
      font-size: 1.0em;
      color: blue;
    }

    button:hover {
      background: rgba(255,255,255,1);
    }

    a, a:visited, a:active {
      color: #39FF14;
      text-decoration: none;
    }

    .muted { color: rgba(0,0,255,0.75); }
    .tiny { font-size: 0.95em; }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    fieldset {
      border: 1px solid rgba(0,0,0,0.2);
      border-radius: 14px;
      padding: 10px 12px 12px;
      background: rgba(255,255,255,0.65);
    }

    legend {
      padding: 0 8px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .legend-actions {
      display: inline-flex;
      gap: 6px;
      margin-left: auto;
    }

    .legend-actions button {
      padding: 4px 8px;
      border-radius: 10px;
      font-size: 0.95em;
    }

    label {
      display: flex;
      gap: 10px;
      align-items: center;
      margin: 6px 0;
    }

    textarea {
      width: 100%;
      height: 84px;
      margin-top: 10px;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.2);
      font-family: inherit;
      font-size: 1.0em;
      color: blue;
      background: rgba(255,255,255,0.85);
    }
  </style>
</head>

<body>
  <div class="panel">
    <h2>Adam's search page :)</h2>

    <div class="row">
      <input id="term" type="text" placeholder='Search term (e.g. "tamagotchi")' />
      <button id="searchBtn">Search</button>
      <button id="copyBtn">Copy query</button>
      <span class="muted tiny">Tip: use quotes for exact phrases.</span>
      <span style="margin-left:auto;"></span>
      <a href="index.html">‚Üê back home</a>
    </div>

    <div class="row">
      <strong>Quick actions:</strong>
      <button data-action="all">Select all</button>
      <button data-action="none">Select none</button>
      <button data-action="invert">Invert</button>

      <span style="margin-left:10px;"></span>

      <strong>Tag filter:</strong>
      <select id="tagFilter">
        <option value="__all__">All tags</option>
      </select>

      <span class="muted tiny">Group All/None buttons are inside each group box.</span>
    </div>

    <div class="grid" id="groups"></div>

    <textarea id="queryOut" readonly></textarea>
  </div>

<script>
/*
  Groups are your main buckets (Art/Theory, Lit/Essay, Ecology, Poetry).
  Tags are optional extra metadata; tag filter is purely UI show/hide.
*/
const publications = [
  // group, name, domain, tags[]

  // --- Art/Theory ---
  ["Art/Theory", "e-flux", "e-flux.com", ["art","theory"]],
  ["Art/Theory", "Artforum", "artforum.com", ["art","criticism"]],
  ["Art/Theory", "ArtReview", "artreview.com", ["art","criticism"]],
  ["Art/Theory", "Texte zur Kunst", "textezurkunst.de", ["theory","art"]],
  ["Art/Theory", "Spike", "spikeartmagazine.com", ["art","criticism"]],
  ["Art/Theory", "Grey Room", "greyroom.org", ["theory","academia"]],
  ["Art/Theory", "Brooklyn Rail", "brooklynrail.org", ["art","criticism"]],
  ["Art/Theory", "Tank", "tank.tv", ["art","culture"]],
  ["Art/Theory", "Cabinet", "cabinetmagazine.org", ["art","theory"]],
  ["Art/Theory", "&&&", "tripleampersand.org", ["theory","culture"]],

  // --- Lit/Essay ---
  ["Lit/Essay", "The Baffler", "thebaffler.com", ["politics","criticism"]],
  ["Lit/Essay", "Granta", "granta.com", ["literary"]],
  ["Lit/Essay", "The White Review", "thewhitereview.org", ["literary","criticism"]],
  ["Lit/Essay", "The Stinging Fly", "stingingfly.org", ["literary"]],
  ["Lit/Essay", "The Drift", "thedriftmag.com", ["politics","literary"]],
  ["Lit/Essay", "SPAM Zine", "spamzine.co.uk", ["literary","poetry"]],  // intentionally in BOTH Lit/Essay and Poetry

  // --- Ecology ---
  ["Ecology", "Ambient Receiver", "ambientreceiver.org", ["sound","ecology"]],
  ["Ecology", "Emergence Magazine", "emergencemagazine.org", ["ecology","culture"]],

  // --- Poetry ---
  ["Poetry", "The Diagram", "thediagram.com", ["poetry","weird"]],
  ["Poetry", "Poetry Foundation", "poetryfoundation.org", ["poetry"]],
  ["Poetry", "Asymptote", "asymptotejournal.com", ["poetry","translation","literary"]],
  ["Poetry", "Blackbox Manifold", "blackboxmanifold.sites.sheffield.ac.uk", ["poetry","theory"]],
  ["Poetry", "SPAM Zine", "spamzine.co.uk", ["poetry","literary"]],     // duplicate on purpose
];

// --- build UI ---
const groupsEl = document.getElementById("groups");
const tagFilterEl = document.getElementById("tagFilter");
const queryOut = document.getElementById("queryOut");
const termEl = document.getElementById("term");

// Build tag dropdown from tags present
const allTags = new Set();
publications.forEach(p => p[3].forEach(t => allTags.add(t)));
[...allTags].sort().forEach(t => {
  const opt = document.createElement("option");
  opt.value = t; opt.textContent = t;
  tagFilterEl.appendChild(opt);
});

function makeId(group, domain, name){
  // include group and name so duplicates (e.g. SPAM Zine) don't collide
  const raw = `${group}__${name}__${domain}`;
  return "cb_" + raw.replace(/[^a-z0-9]/gi, "_");
}

function render(){
  groupsEl.innerHTML = "";
  const byGroup = new Map();
  publications.forEach(([group,name,domain,tags]) => {
    if(!byGroup.has(group)) byGroup.set(group, []);
    byGroup.get(group).push({name,domain,tags,group});
  });

  // Keep group order stable (so it doesn't depend on insertion quirks)
  const groupOrder = ["Art/Theory", "Lit/Essay", "Poetry", "Ecology"];
  const orderedGroups = groupOrder.filter(g => byGroup.has(g));

  for (const group of orderedGroups){
    const items = byGroup.get(group);

    const fs = document.createElement("fieldset");
    fs.dataset.group = group;

    const lg = document.createElement("legend");
    lg.innerHTML = `
      <span>${group}</span>
      <span class="legend-actions">
        <button type="button" data-group-action="all" data-group="${group}">All</button>
        <button type="button" data-group-action="none" data-group="${group}">None</button>
      </span>
    `;
    fs.appendChild(lg);

    items.forEach(({name,domain,tags,group}) => {
      const id = makeId(group, domain, name);
      const lab = document.createElement("label");
      lab.dataset.tags = tags.join(",");
      lab.dataset.group = group;
      lab.innerHTML = `
        <input type="checkbox"
               id="${id}"
               data-domain="${domain}"
               data-group="${group}"
               checked />
        <span><strong>${name}</strong>
          <span class="muted">(${domain})</span>
          <span class="muted">[${tags.join(", ")}]</span>
        </span>
      `;
      fs.appendChild(lab);
    });

    groupsEl.appendChild(fs);
  }

  updateQuery();
  applyTagFilter();
}

function selectedDomains(){
  // Include all checked boxes (even if hidden by tag filter).
  // We de-duplicate domains so SPAM appearing twice doesn't create repeated site: clauses.
  const domains = [...document.querySelectorAll('input[type="checkbox"][data-domain]')]
    .filter(cb => cb.checked)
    .map(cb => cb.dataset.domain);

  return [...new Set(domains)];
}

function buildQuery(){
  const term = termEl.value.trim();
  const domains = selectedDomains();

  const siteClause = domains.length
    ? "(" + domains.map(d => `site:${d}`).join(" OR ") + ")"
    : "";

  return (term ? term + " " : "") + siteClause;
}

function updateQuery(){
  queryOut.value = buildQuery().trim();
}

function applyTagFilter(){
  const tag = tagFilterEl.value;
  const labels = [...document.querySelectorAll("label[data-tags]")];
  labels.forEach(lab => {
    if(tag === "__all__") { lab.style.display = ""; return; }
    const tags = lab.dataset.tags.split(",");
    lab.style.display = tags.includes(tag) ? "" : "none";
  });
  // tag filter does NOT change selection; it only hides/shows rows.
}

// events
document.addEventListener("change", (e) => {
  if(e.target.matches('input[type="checkbox"][data-domain]')) updateQuery();
  if(e.target === tagFilterEl) applyTagFilter();
});

document.addEventListener("click", (e) => {
  // global quick actions
  if (e.target.matches("button[data-action]")) {
    const action = e.target.dataset.action;
    const boxes = [...document.querySelectorAll('input[type="checkbox"][data-domain]')];
    if(action === "all") boxes.forEach(b => b.checked = true);
    if(action === "none") boxes.forEach(b => b.checked = false);
    if(action === "invert") boxes.forEach(b => b.checked = !b.checked);
    updateQuery();
    return;
  }

  // group actions
  if (e.target.matches("button[data-group-action]")) {
    const group = e.target.dataset.group;
    const action = e.target.dataset.groupAction;

    const boxes = [...document.querySelectorAll(`input[type="checkbox"][data-group="${CSS.escape(group)}"]`)];
    if(action === "all") boxes.forEach(b => b.checked = true);
    if(action === "none") boxes.forEach(b => b.checked = false);

    updateQuery();
    return;
  }
});

document.getElementById("searchBtn").addEventListener("click", () => {
  const q = buildQuery().trim();
  if(!q) return;
  window.open("https://www.google.com/search?q=" + encodeURIComponent(q), "_blank");
});

document.getElementById("copyBtn").addEventListener("click", async () => {
  const q = buildQuery().trim();
  if(!q) return;
  try { await navigator.clipboard.writeText(q); } catch {}
});

termEl.addEventListener("keydown", (e) => {
  if(e.key === "Enter") document.getElementById("searchBtn").click();
});

render();
</script>
</body>
</html>
